<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SkyCast ‚Ä¢ Genzie</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://openweathermap.org/img/wn/04d@4x.png">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --bg: #0f172a;
            --card: rgba(30, 41, 59, 0.7);
            --pink: #ff007a;
            --blue: #0ea5e9;
            --text: #ffffff;
            --glass: blur(15px);
        }

        body {
            margin: 0;
            font-family: -apple-system, sans-serif;
            background: radial-gradient(circle at top left, #1e1b4b, #0f172a);
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding-bottom: 30px;
            -webkit-tap-highlight-color: transparent;
        }

        header {
            width: 100%; padding: 50px 20px 10px; box-sizing: border-box;
        }
        .brand {
            font-size: 1.8rem; font-weight: 900;
            background: linear-gradient(90deg, var(--pink), var(--blue));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-transform: uppercase;
        }

        main { width: 100%; max-width: 480px; padding: 0 20px; box-sizing: border-box; }

        .card {
            background: var(--card); backdrop-filter: var(--glass); -webkit-backdrop-filter: var(--glass);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 28px; padding: 24px; margin-bottom: 20px;
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5);
        }

        .btn-loc {
            background: linear-gradient(135deg, var(--pink), #be185d);
            border: none; color: white; padding: 16px; border-radius: 20px; font-weight: 700; width: 100%;
            display: flex; justify-content: center; align-items: center; gap: 10px; font-size: 0.95rem; cursor: pointer;
            margin-bottom: 20px; box-shadow: 0 8px 20px rgba(255, 0, 122, 0.3);
        }

        .temp-big { font-size: 4.5rem; font-weight: 800; line-height: 1; }
        .condition { font-size: 1.1rem; color: var(--blue); font-weight: 600; text-transform: capitalize; margin-top: 5px; }
        .quote { margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); font-style: italic; opacity: 0.8; font-size: 0.9rem; }

        .grid-details { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .detail-box { background: rgba(255,255,255,0.05); border-radius: 15px; padding: 12px; text-align: center; }
        .detail-lbl { font-size: 0.7rem; opacity: 0.6; text-transform: uppercase; font-weight: 700; }
        .detail-val { font-size: 1rem; font-weight: 700; margin-top: 3px; }

        #map { height: 320px; width: 100%; border-radius: 22px; background: #111; z-index: 1; }
        
        /* WARSTWY */
        .controls { display: flex; gap: 8px; overflow-x: auto; padding: 15px 0; scrollbar-width: none; }
        .controls::-webkit-scrollbar { display: none; }
        .pill { 
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); padding: 8px 16px; 
            border-radius: 50px; color: white; font-size: 0.8rem; white-space: nowrap; cursor: pointer; 
        }
        .pill.active { background: var(--blue); border-color: var(--blue); font-weight: 700; }

        /* PANEL DOLNY MAPY */
        .bottom-panel {
            background: rgba(0,0,0,0.3); border-radius: 20px; padding: 15px; margin-top: 10px; min-height: 60px;
            display: flex; flex-direction: column; justify-content: center;
        }

        /* SUWAK (Dla Radaru) */
        #radar-ui { display: block; }
        input[type=range] { width: 100%; accent-color: var(--pink); height: 6px; cursor: pointer; margin: 10px 0; }
        .slider-labels { display: flex; justify-content: space-between; font-size: 0.7rem; opacity: 0.6; font-weight: 700; }
        
        /* LEGENDA (Dla innych) */
        #legend-ui { display: none; text-align: center; }
        .legend-bar { height: 10px; width: 100%; border-radius: 5px; margin: 8px 0; position: relative; }
        .legend-labels { display: flex; justify-content: space-between; font-size: 0.7rem; font-weight: 700; }

        /* Gradienty legendy */
        .grad-temp { background: linear-gradient(90deg, #99f, #0ff, #0f0, #ff0, #f00, #400); }
        .grad-wind { background: linear-gradient(90deg, #fff, #0ff, #0f0, #ff0, #f00); }
        .grad-press { background: linear-gradient(90deg, #00f, #0ff, #fff, #ff0); }

        canvas { width: 100% !important; height: 180px !important; }
    </style>
</head>
<body>

<header>
    <div class="brand">SKYCAST ‚Ä¢ GENZIE</div>
    <div style="font-size: 0.8rem; opacity: 0.6; margin-top: 5px;" id="today-date">...</div>
</header>

<main>
    <button class="btn-loc" onclick="getLocation()">
        üìç ZNAJD≈π MNIE
    </button>

    <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <div>
                <div id="loc-name" style="font-weight:700; opacity:0.7; letter-spacing:1px; text-transform:uppercase;">Szukam...</div>
                <div class="temp-big" id="main-temp">--¬∞</div>
                <div class="condition" id="desc">--</div>
            </div>
            <div style="font-size:3.5rem;" id="icon">‚òÅÔ∏è</div>
        </div>
        
        <div class="grid-details">
            <div class="detail-box">
                <div class="detail-lbl">Odczuwalna</div>
                <div class="detail-val" id="feel">--¬∞</div>
            </div>
            <div class="detail-box">
                <div class="detail-lbl">Wiatr</div>
                <div class="detail-val" id="wind">-- km/h</div>
            </div>
            <div class="detail-box">
                <div class="detail-lbl">Wilgotno≈õƒá</div>
                <div class="detail-val" id="hum">--%</div>
            </div>
            <div class="detail-box">
                <div class="detail-lbl">Ci≈õnienie</div>
                <div class="detail-val" id="press">-- hPa</div>
            </div>
        </div>

        <div class="quote" id="advice">≈Åadowanie fitu... üì°</div>
    </div>

    <div class="card">
        <h3 style="margin:0 0 15px 0; font-size:0.8rem; color:var(--pink); text-transform:uppercase;">Nastƒôpne 24h üìà</h3>
        <div style="position:relative; height:160px;">
            <canvas id="chart"></canvas>
        </div>
    </div>

    <div class="card" style="padding:15px;">
        <h3 style="margin:0 0 5px 5px; font-size:0.8rem; color:var(--blue); text-transform:uppercase;">Mapa Pogodowa</h3>
        
        <div class="controls">
            <button class="pill active" onclick="setLayer('radar', this)">üåßÔ∏è Opady</button>
            <button class="pill" onclick="setLayer('temp_new', this)">üå°Ô∏è Temp</button>
            <button class="pill" onclick="setLayer('wind_new', this)">üí® Wiatr</button>
            <button class="pill" onclick="setLayer('pressure_new', this)">‚è≤Ô∏è Ci≈õn</button>
        </div>

        <div id="map"></div>

        <div class="bottom-panel">
            
            <div id="radar-ui">
                <div style="text-align:center; font-weight:800; font-size:0.85rem; color:var(--pink); margin-bottom:5px;" id="radar-time">TERAZ</div>
                <input type="range" id="radar-range" min="0" max="0" value="0" oninput="updateFrame(this.value)">
                <div class="slider-labels">
                    <span>HISTORIA</span>
                    <span>TERAZ</span>
                    <span>PROGNOZA</span>
                </div>
            </div>

            <div id="legend-ui">
                <div style="font-size:0.8rem; font-weight:700; color:var(--blue); margin-bottom:5px;" id="legend-title">MAPA LIVE</div>
                <div class="legend-bar" id="legend-gradient"></div>
                <div class="legend-labels" id="legend-text">
                    <span>MIN</span><span>MAX</span>
                </div>
            </div>

        </div>
    </div>
</main>

<script>
    const OWM_KEY = "07c3b3e89d44a0eeb75b69e69c4b2264";
    const DAYS = ['ND', 'PN', 'WT', '≈öR', 'CZ', 'PT', 'SB'];
    
    let map = null, chart = null, radarLayers = [], radarFrames = [], activeOverlay = null;

    function init() {
        const d = new Date();
        document.getElementById('today-date').innerText = `${DAYS[d.getDay()]}, ${d.getDate()}.${d.getMonth()+1}.${d.getFullYear()}`;
        
        map = L.map('map', { zoomControl:false, attributionControl:false }).setView([52.23, 21.01], 6);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);
        
        // Start Default
        fetchWeather(52.23, 21.01, "WARSZAWA");
        loadRadar();
    }

    function getLocation() {
        navigator.geolocation.getCurrentPosition(p => {
            const lat = p.coords.latitude;
            const lon = p.coords.longitude;
            map.setView([lat, lon], 10);
            fetchWeather(lat, lon, "TWOJA POZYCJA");
        }, () => alert("W≈ÇƒÖcz GPS w ustawieniach! üìç"));
    }

    async function fetchWeather(lat, lon, label) {
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,rain,showers,snowfall,weather_code,surface_pressure,wind_speed_10m&hourly=temperature_2m&forecast_days=2`;

        try {
            const res = await fetch(url);
            const data = await res.json();
            updateUI(data.current, label);
            updateChart(data.hourly);
        } catch(e) { console.error(e); }
    }

    function updateUI(cur, label) {
        document.getElementById('loc-name').innerText = label;
        document.getElementById('main-temp').innerText = Math.round(cur.temperature_2m) + "¬∞";
        document.getElementById('feel').innerText = Math.round(cur.apparent_temperature) + "¬∞";
        document.getElementById('wind').innerText = Math.round(cur.wind_speed_10m) + " km/h";
        document.getElementById('hum').innerText = cur.relative_humidity_2m + "%";
        document.getElementById('press').innerText = Math.round(cur.surface_pressure) + " hPa";

        const code = cur.weather_code;
        const info = getIcon(code);
        document.getElementById('desc').innerText = info.txt;
        document.getElementById('icon').innerText = info.ico;

        let msg = "";
        const t = cur.temperature_2m;
        if(cur.rain > 0 || cur.showers > 0) msg = "Pada... üåßÔ∏è We≈∫ parasol, bo fryzura ucierpi. Drama.";
        else if(cur.snowfall > 0) msg = "Sypie! ‚ùÑÔ∏è Ale klimat. Ubieraj siƒô grubo!";
        else if(t > 25) msg = "Jest hot! üî• Kr√≥tki rƒôkaw i lecimy!";
        else if(t > 15) msg = "Vibe check pozytywny. Bluza Genzie wystarczy. üëå";
        else if(t > 5) msg = "Trochƒô pizga. ü•∂ We≈∫ kurtkƒô, no cap.";
        else msg = "Mrozi potƒô≈ºnie. üßä Herbata, koc i siedzimy w domu.";
        document.getElementById('advice').innerText = msg;
    }

    function updateChart(hourly) {
        const nowIso = new Date().toISOString().slice(0, 13);
        let startIdx = 0;
        for(let i=0; i<hourly.time.length; i++) {
            if(hourly.time[i] >= nowIso) { startIdx = i; break; }
        }
        
        const labels = hourly.time.slice(startIdx, startIdx+24).map(t => new Date(t).getHours()+":00");
        const data = hourly.temperature_2m.slice(startIdx, startIdx+24);

        const ctx = document.getElementById('chart').getContext('2d');
        if(chart) chart.destroy();
        chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    data: data, borderColor: '#ff007a', borderWidth: 3,
                    backgroundColor: 'rgba(255, 0, 122, 0.1)', fill: true, tension: 0.4,
                    pointRadius: 0, pointHitRadius: 10
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: false },
                scales: { x: { display: false }, y: { display: false } }
            }
        });
    }

    function setLayer(type, btn) {
        document.querySelectorAll('.pill').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        if(activeOverlay) map.removeLayer(activeOverlay);
        radarLayers.forEach(l => map.removeLayer(l));

        const rUI = document.getElementById('radar-ui');
        const lUI = document.getElementById('legend-ui');
        const lBar = document.getElementById('legend-gradient');
        const lTxt = document.getElementById('legend-text');

        if(type === 'radar') {
            rUI.style.display = 'block';
            lUI.style.display = 'none';
            loadRadar();
        } else {
            rUI.style.display = 'none';
            lUI.style.display = 'block';
            
            // Konfiguracja Legendy
            if(type === 'temp_new') {
                lBar.className = 'legend-bar grad-temp';
                lTxt.innerHTML = '<span>ZIMNO (-20¬∞)</span><span>CIEP≈ÅO (+40¬∞)</span>';
            } else if(type === 'wind_new') {
                lBar.className = 'legend-bar grad-wind';
                lTxt.innerHTML = '<span>SPOK√ìJ</span><span>WICHURA</span>';
            } else {
                lBar.className = 'legend-bar grad-press';
                lTxt.innerHTML = '<span>NISKIE</span><span>WYSOKIE</span>';
            }

            activeOverlay = L.tileLayer(`https://tile.openweathermap.org/map/${type}/{z}/{x}/{y}.png?appid=${OWM_KEY}`, { opacity: 0.6, zIndex: 100 }).addTo(map);
        }
    }

    async function loadRadar() {
        const res = await fetch("https://api.rainviewer.com/public/weather-maps.json");
        const data = await res.json();
        radarFrames = [...data.radar.past, ...data.radar.nowcast];
        radarLayers = radarFrames.map(f => L.tileLayer(`https://tilecache.rainviewer.com/v2/radar/${f.time}/256/{z}/{x}/{y}/2/1_1.png`, { opacity: 0, zIndex: 200 }).addTo(map));
        
        const slider = document.getElementById('radar-range');
        slider.max = radarFrames.length - 1;
        slider.value = radarFrames.length - 1;
        updateFrame(slider.value);
    }

    function updateFrame(idx) {
        radarLayers.forEach((l, i) => l.setOpacity(i == idx ? 0.8 : 0));
        const d = new Date(radarFrames[idx].time * 1000);
        const mins = d.getMinutes().toString().padStart(2, '0');
        const isFore = idx > radarFrames.length - 4;
        document.getElementById('radar-time').innerText = `${d.getHours()}:${mins} ${isFore ? '(PROGNOZA)' : ''}`;
    }

    function getIcon(code) {
        const map = {
            0: {txt:"Czysto", ico:"‚òÄÔ∏è"}, 1: {txt:"Pogodnie", ico:"üå§Ô∏è"}, 2: {txt:"Pochmurno", ico:"‚õÖ"},
            3: {txt:"Chmury", ico:"‚òÅÔ∏è"}, 45: {txt:"Mg≈Ça", ico:"üå´Ô∏è"}, 51: {txt:"M≈ºawka", ico:"üåßÔ∏è"},
            61: {txt:"Deszcz", ico:"üåßÔ∏è"}, 63: {txt:"Ulewa", ico:"üåßÔ∏è"}, 71: {txt:"≈önieg", ico:"‚ùÑÔ∏è"},
            80: {txt:"Przelotne", ico:"üå¶Ô∏è"}, 95: {txt:"Burza", ico:"‚ö°"}
        };
        return map[code] || {txt:"Meteo", ico:"üå°Ô∏è"};
    }

    init();
</script>
</body>
</html>
